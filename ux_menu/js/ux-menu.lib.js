!function(n,e,t){"use strict";function a(e,t){this.element=e,this._name=s,this._defaults=n.fn.uxMenu.defaults,this.options=n.extend({},this._defaults,t),this.animationEvent=i(),this.init()}function i(){var n,e=t.createElement("fakeelement"),a={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(n in a)if("undefined"!==e.style[n])return a[n]}var s="uxMenu";n.extend(a.prototype,{init:function(){this.buildCache(),this.buildElement(),this.bindEvents()},destroy:function(){this.unbindEvents(),this.$element.removeData()},buildCache:function(){this.$element=n(this.element),this.$nav=this.$element.find(".ux-menu-nav"),this.$wrap=this.$nav.find(".ux-menu-wrap"),this.$menus=this.$nav.find(".ux-menu-level"),this.menusArr=[],this.breadCrumbs=!1,(this.options.breadcrumbNav||this.options.backNav)&&(this.$navHeader=this.$nav.find(".ux-menu-nav-header"));var e=0;this.$menus.each(function(t){n(this).find(".ux-menu-link.is-active").length&&(e=t)}),this.current_menu=e},buildElement:function(){var e=this,t=[];this.$menus.each(function(a){var i=n(this),s={$menuEl:i,$menuItems:i.find(".ux-menu-item")};e.menusArr.push(s),a===e.current_menu&&(i.addClass("ux-menu-level--current"),e.setWrapHeight(i)),i.find(".ux-menu-link[data-submenu]").each(function(){var e=n(this),i=e.attr("data-submenu"),s={menu:i,name:e.html()};t[a]?t[a].push(s):(t[a]=[],t[a].push(s))})}),this.$menus.each(function(a){var i=n(this),s=i.attr("data-menu");t.forEach(function(n,t){n.forEach(function(n,i){n.menu===s&&(e.log("Parent found for "+n.name+" as "+t),e.menusArr[a].backIdx=t,e.menusArr[a].name=n.name)})})}),e.options.breadcrumbNav&&(e.$breadcrumbNav=n('<nav class="ux-menu-breadcrumbs" aria-label="You are here"></nav>').prependTo(e.$navHeader),e.addBreadcrumb(0),0!==e.menusArr[e.current_menu].backIdx&&0!==e.current_menu&&(e.crawlCrumbs(e.menusArr[e.current_menu].backIdx,e.menusArr),e.breadCrumbs=!0),0!==e.current_menu&&(e.addBreadcrumb(e.current_menu),e.breadCrumbs=!0)),e.options.backNav&&(e.$backNav=n('<button class="ux-menu-back" aria-label="Go back"></button>').appendTo(e.$navHeader),e.$backNav.html('<span class="fa fa-arrow-left"></span> Back'))},bindEvents:function(){for(var e=this,t=0,a=this.menusArr.length;t<a;++t)this.menusArr[t].$menuItems.each(function(t){n(this).find(".ux-menu-link[data-submenu]").on("click",function(a){var i=n(this),s=i.html(),u=i.attr("data-submenu"),r=e.$nav.find('.ux-menu-level[data-menu="'+u+'"]');r.length?(a.preventDefault(),e.openSubMenu(r,t,s)):(e.$nav.find(".ux-menu-link--current").removeClass("ux-menu-link--current"),i.addClass("ux-menu-link--current"))})});this.options.backNav&&this.$backNav.on("click",function(n){e.back()})},addBreadcrumb:function(e){if(!this.options.breadcrumbNav)return!1;var t=this,a=e?this.menusArr[e].name:this.options.breadcrumbInitialText,i=n('<a href="#"></a>').html(a);this.log("Add Crumb "+a+" ("+e+")"),i.on("click",function(n){if(n.preventDefault(),!i.next().length||t.isAnimating)return!1;t.isAnimating=!0,t.menuOut();var a=t.menusArr[e].$menuEl;t.menuIn(a);var s=i.nextAll();s.one(t.animationEvent,function(n){s.remove()}).addClass("animate-fadeOut")}),this.$breadcrumbNav.append(i),i.addClass("animate-fadeIn")},crawlCrumbs:function(n,e){this.log("Crawl Crumbs"),0!==e[n].backIdx&&this.crawlCrumbs(e[n].backIdx,e),this.addBreadcrumb(n)},openSubMenu:function(n,e,t){if(this.isAnimating)return!1;var a=this.$menus.index(n);this.isAnimating=!0,this.menusArr[a].backIdx=this.current_menu,this.menusArr[a].name=t,this.menuOut(e),this.menuIn(n,e)},back:function(){if(this.isAnimating)return!1;this.isAnimating=!0,this.menuOut();var n=this.menusArr[this.menusArr[this.current_menu].backIdx].$menuEl;this.menuIn(n),this.options.breadcrumbNav&&this.$breadcrumbNav.children().last().remove()},menuOut:function(n){var e=this,t=this.menusArr[this.current_menu].$menuEl,a="undefined"==typeof n;this.menusArr[this.current_menu].$menuItems.each(function(t){this.style.WebkitAnimationDelay=this.style.animationDelay=a?parseInt(t*e.options.itemsDelayInterval)+"ms":parseInt(Math.abs(n-t)*e.options.itemsDelayInterval)+"ms"}),"r2l"===this.options.direction?t.addClass(a?"animate-outToRight":"animate-outToLeft"):t.addClass(a?"animate-outToLeft":"animate-outToRight")},setWrapHeight:function(e){var t=0;e.children().each(function(){t+=n(this).outerHeight()}),this.$wrap.height(t)},menuIn:function(e,t){var a=this,i=this.menusArr[this.current_menu].$menuEl,s="undefined"==typeof t,u=this.$menus.index(e),r=this.menusArr[u],m=r.$menuItems,o=m.length;a.setWrapHeight(e),s?0===u&&a.options.backNav&&a.$backNav.removeClass("animate-fadeIn").addClass("animate-fadeOut"):(a.options.backNav&&a.$backNav.removeClass("animate-fadeOut").addClass("animate-fadeIn"),a.addBreadcrumb(u)),m.each(function(r){this.style.WebkitAnimationDelay=this.style.animationDelay=s?parseInt(r*a.options.itemsDelayInterval)+"ms":parseInt(Math.abs(t-r)*a.options.itemsDelayInterval)+"ms";var m=t<=o/2||s?o-1:0;r===m&&n(this).one(a.animationEvent,function(n){"r2l"===a.options.direction?(i.removeClass(s?"animate-outToRight":"animate-outToLeft"),e.removeClass(s?"animate-inFromLeft":"animate-inFromRight")):(i.removeClass(s?"animate-outToLeft":"animate-outToRight"),e.removeClass(s?"animate-inFromRight":"animate-inFromLeft")),i.removeClass("ux-menu-level--current"),e.addClass("ux-menu-level--current"),a.current_menu=u,a.isAnimating=!1,e.focus()})}),"r2l"===this.options.direction?e.addClass(s?"animate-inFromLeft":"animate-inFromRight"):e.addClass(s?"animate-inFromRight":"animate-inFromLeft")},unbindEvents:function(){this.$element.off("."+this._name)},log:function(n){this.options.debug&&("object"==typeof n?console.log("["+this._name+"]",n):console.log("["+this._name+"] "+n))},error:function(n){"object"==typeof n?console.error("["+this._name+"]",n):console.error("["+this._name+"] "+n)}}),n.fn.uxMenu=function(e){return this.each(function(){n.data(this,s)||n.data(this,s,new a(this,e))}),this},n.fn.uxMenu.defaults={debug:!1,breadcrumbNav:!0,breadcrumbInitialText:"All",backNav:!1,itemsDelayInterval:60,direction:"r2l",onItemClick:null}}(jQuery,window,document);